---
title: "ds2 hw2"
author: "Ruihan Zhang"
date: "2023-03-08"
output: github_document
---

```{r}
library(caret)
library(glmnet)
library(mlbench)
library(splines)
library(mgcv)
library(pROC)
library(earth)
library(tidyverse)
library(ggplot2)
library(pdp)
library(vip)
library(AppliedPredictiveModeling)
```
```{r}
college_data = read_csv("./College.csv")[-1] %>% 
  janitor::clean_names() %>% 
  na.omit()
```
```{r}
set.seed(2023)
train_index=createDataPartition(y=college_data$outstate, p=0.8, list = FALSE)
college_train=college_data[train_index,]
college_test=college_data[-train_index,]
x =  college_train %>% dplyr::select(-outstate)
y = college_train$outstate
```

```{r}
#1.
fit.ss=smooth.spline(college_train$perc_alumni,college_train$outstate)

```
```{r}
perc_alumni.grid = seq(from=min(unique(college_train$perc_alumni))-10, to = max(unique(college_train$perc_alumni))+10, by=1)
pred.ss=predict(fit.ss,x=perc_alumni.grid)
pred.ss.df=data_frame(pred=pred.ss$y,perc_alumni=perc_alumni.grid)
p=ggplot(data=college_data,aes(x=perc_alumni, y=outstate))+geom_point(color=rgb(0.2, 0.4, 0.2, 0.5))
p+geom_line(aes(x=perc_alumni.grid, y=pred),data=pred.ss.df,color=rgb(0.8,0.1,0.1,1))+theme_bw()
```

```{r}
gam.m=gam(outstate ~ apps+accept+enroll+s(top10perc)+top25perc+s(f_undergrad)+p_undergrad+s(room_board)+s(books)+personal+s(ph_d)+terminal+s(s_f_ratio)+perc_alumni+s(expend)+s(grad_rate), data = college_train)
plot(gam.m)
summary(gam.m)
gam.m$df.residual
rmse=sqrt(mean(residuals.gam(gam.m,type = "response")**2))
rmse
gam.pre=predict(gam.m, newdata = college_data[-train_index,])
tmse=mean((college_data[-train_index,]$outstate-gam.pre)**2)
tmse
```
```{r}
ctrl1=trainControl(method = "cv", number = 10)
mars_grid=expand.grid(degree=1:3,nprune=2:15)
set.seed(2023)
mars.fit=train(x,y,method = "earth", tuneGrid = mars_grid,trControl = ctrl1)
ggplot(mars.fit)
mars.fit$bestTune
coef(mars.fit$finalModel)
mars_pre=predict(mars.fit,newdata = college_data[-train_index,])
t_mse=mean((college_data[-train_index,]$outstate-mars_pre)**2)
t_mse
```

